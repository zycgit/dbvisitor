---
id: feature
sidebar_position: 9
hide_table_of_contents: true
title: Advanced Features
description: This section introduces some advanced features and related parameters of JdbcTemplate.
---
:::tip[Hint]
This article is generated by AI translation.
:::

import TOCInline from '@theme/TOCInline';

# Advanced Features

This section introduces some advanced features and related parameters of JdbcTemplate:

<TOCInline toc={toc} />

## Print Error Logs and SQL {#stmterror}

Set _**printStmtError**_ to print the failing SQL when an SQL error occurs.
- Property: _**printStmtError**_.
- Default: _**false**_, meaning logs are not printed.

```text title='Example with printStmtError = true'
Failed SQL statement [select * from test_user2 where id > 10].
java.sql.SQLSyntaxErrorException: Table 'devtester.test_user2' doesn't exist
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:120)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.StatementImpl.executeQuery(StatementImpl.java:1200)
	at com.zaxxer.hikari.pool.ProxyStatement.executeQuery(ProxyStatement.java:110)
	at com.zaxxer.hikari.pool.HikariProxyStatement.executeQuery(HikariProxyStatement.java)
	at net.hasor.dbvisitor.jdbc.core.JdbcTemplate.lambda$query$14(JdbcTemplate.java:468)
	at net.hasor.dbvisitor.jdbc.core.JdbcTemplate.lambda$execute$0(JdbcTemplate.java:240)
	at net.hasor.dbvisitor.jdbc.core.JdbcConnection.execute(JdbcConnection.java:162)
	at net.hasor.dbvisitor.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:237)
	at net.hasor.dbvisitor.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:467)
	at net.hasor.dbvisitor.jdbc.core.JdbcTemplate.queryForList(JdbcTemplate.java:581)
	at com.example.demo.jdbc.Execute1SqlMain.main(Execute1SqlMain.java:24)
```

## Database Warning Messages {#warnings}

By setting _**ignoreWarnings**_, dbVisitor will throw an exception on SQL warnings.
- Property: _**ignoreWarnings**_.
- Default: _**true**_, meaning SQL warnings are ignored.

```sql title="SQL that triggers a MySQL 8.0 warning"
create table test_table (
    id   bigint,
    name national char(10)
)
```

```text title="Warning content"
NATIONAL/NCHAR/NVARCHAR implies the character set UTF8MB3, which will be replaced by UTF8MB4 in a future release. 
Please consider using CHAR(x) CHARACTER SET UTF8MB4 in order to be unambiguous.
```

```text title='With ignoreWarnings = false'
Exception in thread "main" java.sql.SQLException: Warning not ignored
	at net.hasor.dbvisitor.jdbc.core.JdbcConnection.handleWarnings(JdbcConnection.java:225)
	at net.hasor.dbvisitor.jdbc.core.JdbcConnection.lambda$execute$0(JdbcConnection.java:182)
	at net.hasor.dbvisitor.jdbc.core.JdbcConnection.execute(JdbcConnection.java:162)
	at net.hasor.dbvisitor.jdbc.core.JdbcConnection.execute(JdbcConnection.java:176)
	at net.hasor.dbvisitor.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:229)
	at com.example.demo.jdbc.Execute1SqlMain.main(Execute1SqlMain.java:20)
Caused by: java.sql.SQLWarning: NATIONAL/NCHAR/NVARCHAR implies the character set UTF8MB3, which will be replaced by UTF8MB4 in a future release. Please consider using CHAR(x) CHARACTER SET UTF8MB4 in order to be unambiguous.
	at com.mysql.cj.protocol.a.NativeProtocol.convertShowWarningsToSQLWarnings(NativeProtocol.java:2204)
	at com.mysql.cj.jdbc.StatementImpl.getWarnings(StatementImpl.java:1733)
	at com.zaxxer.hikari.pool.HikariProxyStatement.getWarnings(HikariProxyStatement.java)
	at net.hasor.dbvisitor.jdbc.core.JdbcConnection.handleWarnings(JdbcConnection.java:223)
	... 5 more
```

## Query Timeout {#timeout}

Set _**queryTimeout**_ to a value greater than zero to set a timeout on the Statement when JdbcTemplate executes a query, e.g., `java.sql.Statement.setQueryTimeout`.
- Property: _**queryTimeout**_.
- Default: _**0**_, meaning not set.
- Unit: _**seconds**_.

```java
jdbc.setQueryTimeout(6);// This setting affects all subsequent queries
jdbc.queryForList("select * from users");
```

## Query Result fetchSize {#fetchsize}

Set _**fetchSize**_ to a value greater than zero to provide a hint to the JDBC driver through the Statement when JdbcTemplate executes a query.
It hints at the number of rows to fetch from the database when the ResultSet object generated by this Statement needs more rows.
The specified row count only affects result sets created by this statement, e.g., `java.sql.Statement.setFetchSize`.
- Property: _**fetchSize**_.
- Default: _**0**_, meaning not set.
- Unit: _**rows**_.

```java
jdbc.setFetchSize(256);
jdbc.queryForList("select * from users");
```

:::info[This parameter is usually affected by the database driver]
```java title='MySQL streaming'
PreparedStatement ps = con.prepareStatement(
        "select * from test_user",
        ResultSet.TYPE_FORWARD_ONLY,
        ResultSet.CONCUR_READ_ONLY
    );
ps.setFetchSize(Integer.MIN_VALUE);
```

```java title='Postgres 7.4+'
con.setAutoCommit(false);
PreparedStatement ps = con.prepareStatement(
        "select * from test_user",
        ResultSet.TYPE_FORWARD_ONLY,
        ResultSet.CONCUR_READ_ONLY
    );
ps.setFetchSize(255);
```
:::

## maxRows {#maxrows}

Set _**maxRows**_ to a value greater than zero to provide a hint to the JDBC driver through the Statement when JdbcTemplate executes a query.
It limits the maximum number of rows returned from the ResultSet.

For example, setting maxRows to 100 will only fetch the first 100 rows from the ResultSet and ignore the rest.
- Property: _**maxRows**_.
- Default: _**0**_, meaning not set.
- Unit: _**rows**_.


```java
jdbc.setMaxRows(200);// This setting affects all subsequent queries
jdbc.queryForList("select * from users");
```

:::info[Note]
In some database drivers, setting maxRows does not mean that the query will immediately terminate after fetching the specified number of rows.
- For example, MySQL will still consume the extra rows returned by the server after fetching the maxRows number of result rows, but these data will not be added to the result set.
:::

## Dynamic Data Sources {#dynamic}

For some reasons, it may not be possible to provide a DataSource or Connection when creating _**JdbcTemplate**_, or JdbcTemplate's methods may operate on different DataSource or Connection when called.
In such cases, use the _**DynamicConnection**_ dynamic data source interface instead.

```java title='Custom DynamicConnection'
class LocalDynamicConnection implements DynamicConnection {
    @Override
    public Connection getConnection() throws SQLException {
        return ...;// Get Connection for queries
    }

    @Override
    public void releaseConnection(Connection conn) throws SQLException {
        // Release Connection after query
    }
}
```

```java title='Use the dynamic source'
JdbcTemplate jdbc = new JdbcTemplate(new LocalDynamicConnection());
```

:::info[Extended Information]
**SpringDsAdapter** uses Spring's **DataSourceUtils** to obtain and release data source connections as the DynamicConnection implementation logic.
This allows dbVisitor and Spring JDBC's transaction manager to work together cooperatively.

Dependencies required (choose as needed):
- _**[net.hasor:dbvisitor-spring](https://central.sonatype.com/artifact/net.hasor/dbvisitor-spring)**_
- _**[net.hasor:dbvisitor-spring-starter](https://central.sonatype.com/artifact/net.hasor/dbvisitor-spring-starter)**_
:::

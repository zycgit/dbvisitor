---
id: template
sidebar_position: 2
hide_table_of_contents: true
title: Template Mode
description: How to use transaction templates in dbVisitor.
---
:::tip[Hint]
This article is generated by AI translation.
:::

Template transactions follow this general pattern:

```java
try {
    txManager.begin(propagation, isolation);

    ...

    txManager.commit();
} catch (Throwable e) {
    txManager.rollBack();
    throw e;
}
```

Example usage:

```java
TransactionTemplate template = ...
Object result = template.execute(new TransactionCallback<Object>() {
    @Override
    public Object doTransaction(TransactionStatus tranStatus) throws Throwable {
        ...
        return null;
    }
});
```

```java title='Java 8 style'
Object result = template.execute(tranStatus -> {
    return ...;
});
```

```java title='Run a block in a transaction and ignore the return value'
template.execute((TransactionCallbackWithoutResult) tranStatus -> {
    ...
});
```

## Rolling back

There are two ways to roll back when using the template:
- Throw an exception.
- Mark the transaction for rollback via `rollBack` or `readOnly` without throwing.

```java title='Mark rollback without throwing'
Object result = template.execute(new TransactionCallback<Object>() {
    public Object doTransaction(TransactionStatus tranStatus) {
        tranStatus.setReadOnly();
        // 或
        tranStatus.setRollback();

        return ...;
    }
});
```

## Obtain a transaction manager

```java title='From a DataSource'
DataSource dataSource = ...
TransactionManager txManager = TransactionHelper.txManager(dataSource);
```

```java title='Via dependency injection'
public class TxExample {
    // @Inject                 < Guice、Solon 和 Hasor
    // @Resource or @Autowired < Spring
    private TransactionManager txManager;
    ...
}
```

:::info[For DI usage, see the framework-specific docs]
- Spring-based projects: [see details](../../yourproject/with_spring#tran)
- Solon-based projects: [see details](../../yourproject/with_solon#tran)
- In Hasor and Guice you can inject with `@Inject`
    - [Guice Injectable types](../../yourproject/with_guice#inject), [Hasor Injectable types](../../yourproject/with_hasor#inject)
:::
